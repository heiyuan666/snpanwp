# GitHub自动更新功能使用指南

## 🚀 功能概述

速纳云盘上传插件现已集成GitHub自动更新功能，可以：
- 🔍 **自动检测**GitHub仓库的最新版本
- 📢 **智能通知**有新版本可用时的提醒
- 🔄 **一键更新**直接从GitHub下载并安装最新版本
- 📋 **版本对比**显示当前版本与最新版本的差异

## 📋 GitHub仓库信息

- **仓库地址**: https://github.com/heiyuan666/snpanwp
- **API接口**: https://api.github.com/repos/heiyuan666/snpanwp
- **更新检查**: 每24小时自动检查一次
- **版本标识**: 使用Git标签 (如 v1.1.0, v1.2.0)

## 🔧 功能特性

### 1. 自动版本检测
- ✅ **GitHub API集成**：直接从GitHub获取最新版本信息
- ✅ **智能缓存**：避免频繁API请求，每天检查一次
- ✅ **版本比较**：自动比较当前版本与最新版本
- ✅ **发布说明**：显示GitHub Release的更新内容

### 2. 更新通知系统
- 📢 **管理后台通知**：在WordPress后台显示更新提醒
- 🎯 **智能显示**：只在相关页面显示通知
- ❌ **可关闭通知**：用户可以关闭特定版本的通知
- 📅 **发布信息**：显示发布日期和版本号

### 3. 一键自动更新
- 🚀 **一键更新**：点击按钮即可自动更新
- 📥 **自动下载**：从GitHub自动下载最新版本
- 🔄 **自动安装**：自动解压并替换插件文件
- 💾 **自动备份**：更新前自动备份当前版本

### 4. WordPress集成
- 🔌 **插件页面集成**：在WordPress插件页面显示更新
- 📊 **版本信息**：显示详细的版本和更新信息
- 🛡️ **权限检查**：确保只有有权限的用户可以更新
- 🔒 **安全验证**：使用nonce验证防止CSRF攻击

## 📖 使用方法

### 1. 版本检查页面
访问: `yoursite.com/wp-content/plugins/dmy-link1.3.6/version-check.php?check=1`

**功能**:
- 📊 显示当前版本vs最新版本
- 📋 显示GitHub发布说明
- 🔄 提供一键更新按钮
- 📥 提供手动下载链接

### 2. 管理后台通知
- 📍 **显示位置**：插件页面、插件设置页面
- 📢 **通知内容**：新版本信息、更新内容预览
- 🔗 **快速操作**：下载更新、查看设置
- ❌ **关闭通知**：点击X关闭特定版本通知

### 3. 自动更新流程
1. **检测更新**：系统自动检查GitHub最新版本
2. **显示通知**：在管理后台显示更新提醒
3. **一键更新**：点击"一键自动更新"按钮
4. **下载安装**：自动下载并安装最新版本
5. **完成更新**：显示更新结果，建议刷新页面

### 4. 手动更新流程
1. **访问GitHub**：点击链接访问GitHub仓库
2. **下载ZIP**：下载最新版本的ZIP文件
3. **备份插件**：备份当前插件文件和设置
4. **替换文件**：解压并替换插件目录
5. **检查功能**：验证插件功能是否正常

## 🛠️ 技术实现

### 1. GitHub API集成
```php
// 获取最新版本信息
$api_url = 'https://api.github.com/repos/heiyuan666/snpanwp/releases/latest';
$response = wp_remote_get($api_url, array(
    'timeout' => 15,
    'headers' => array('User-Agent' => 'WordPress-Plugin-Updater')
));
```

### 2. 版本比较逻辑
```php
// 比较版本号
$current_version = '1.1.0';
$latest_version = '1.2.0';
$has_update = version_compare($current_version, $latest_version, '<');
```

### 3. 自动更新流程
```php
// 下载 -> 解压 -> 备份 -> 替换 -> 验证
$result = $this->perform_update($download_url);
```

### 4. WordPress钩子集成
```php
// 插件更新检查
add_filter('pre_set_site_transient_update_plugins', array($this, 'check_plugin_updates'));

// 管理后台通知
add_action('admin_notices', array($this, 'show_update_notice'));
```

## 🔍 测试和验证

### 1. 版本检测测试
- ✅ 访问版本检查页面
- ✅ 验证GitHub API连接
- ✅ 检查版本比较逻辑
- ✅ 确认发布说明显示

### 2. 更新通知测试
- ✅ 检查管理后台通知显示
- ✅ 验证通知关闭功能
- ✅ 测试通知样式和交互
- ✅ 确认权限检查

### 3. 自动更新测试
- ✅ 测试一键更新功能
- ✅ 验证下载和安装过程
- ✅ 检查备份和恢复机制
- ✅ 确认更新后功能正常

### 4. 安全性测试
- ✅ 验证权限检查
- ✅ 测试nonce验证
- ✅ 检查文件权限
- ✅ 确认备份机制

## ⚠️ 注意事项

### 1. 服务器要求
- 📁 **文件权限**：需要插件目录的写入权限
- 🌐 **网络连接**：需要能够访问GitHub API
- 💾 **磁盘空间**：需要足够空间下载和解压文件
- ⏱️ **执行时间**：可能需要较长的PHP执行时间

### 2. 安全考虑
- 🔒 **权限控制**：只有管理员可以执行更新
- 🛡️ **文件验证**：验证下载文件的完整性
- 💾 **自动备份**：更新前自动备份当前版本
- 🔄 **回滚机制**：更新失败时自动恢复

### 3. 网络环境
- 🌍 **GitHub访问**：确保服务器可以访问GitHub
- 🚀 **下载速度**：大文件下载可能需要时间
- ⏰ **超时设置**：合理设置网络请求超时时间
- 🔄 **重试机制**：网络失败时的重试策略

### 4. 兼容性
- 🔌 **WordPress版本**：确保WordPress版本兼容
- 🐘 **PHP版本**：确保PHP版本满足要求
- 📦 **插件冲突**：检查与其他插件的兼容性
- 🎨 **主题兼容**：确保与当前主题兼容

## 🐛 故障排除

### 1. 无法检测更新
**问题**: 无法获取GitHub最新版本  
**解决**: 
- 检查网络连接到GitHub
- 验证GitHub API访问权限
- 检查防火墙设置

### 2. 下载失败
**问题**: 无法下载更新文件  
**解决**:
- 检查磁盘空间
- 验证文件权限
- 增加下载超时时间

### 3. 安装失败
**问题**: 更新安装过程失败  
**解决**:
- 检查插件目录权限
- 手动备份和恢复
- 联系技术支持

### 4. 功能异常
**问题**: 更新后功能不正常  
**解决**:
- 清除缓存
- 检查插件设置
- 恢复备份版本

## 📞 技术支持

### 获取帮助
- 🌐 **官方网站**: [www.09cdn.com](https://www.09cdn.com)
- 📧 **技术支持**: 通过官网联系技术支持
- 📖 **GitHub仓库**: [github.com/heiyuan666/snpanwp](https://github.com/heiyuan666/snpanwp)
- 🛠️ **问题报告**: 在GitHub提交Issue

### 反馈渠道
- 🐛 **Bug报告**: GitHub Issues
- 💡 **功能建议**: GitHub Discussions
- ⭐ **使用评价**: 插件评价页面
- 📝 **文档改进**: 提交Pull Request

---

**现在您可以享受便捷的GitHub自动更新功能，始终保持插件的最新版本！** 🎉

**GitHub仓库**: https://github.com/heiyuan666/snpanwp
